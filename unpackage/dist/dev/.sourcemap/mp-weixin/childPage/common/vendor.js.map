{"version":3,"sources":["uni-app:///utils/st.js","uni-app:///utils/nls.js","uni-app:///utils/uuid.js","uni-app:///utils/eventbus.js","uni-app:///utils/util.js"],"names":["NlsClient","require","EventBus","SpeechTranscription","config","_event","_config","format","sample_rate","enable_intermediate_result","enable_punctuation_prediction","enable_inverse_text_normalization","which","handler","on","param","_client","_taskid","uuid","req","header","message_id","task_id","namespace","name","appkey","payload","context","defaultContext","Promise","resolve","reject","start","msg","isBinary","str","toString","msgObj","JSON","parse","emit","shutdown","send","stringify","wx","nextTick","Error","data","module","exports","url","token","onmessage","onclose","_ws","connectSocket","tcpNoDelay","onMessage","res","onClose","code","reason","onOpen","onError","errMsg","close","sdk","version","language","s","hexDigits","i","substr","Math","floor","random","join","split","event","fn","console","error","_stores","push","cb","ctx","store","args","slice","call","arguments","len","length","apply","splice","formatTime","date","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","second","getSeconds","map","formatNumber","padding2","t","utctimestamp","Date","YYYY","getUTCFullYear","MM","getUTCMonth","DD","getUTCDate","HH","getUTCHours","mm","getUTCMinutes","ss","getUTCSeconds","uploadToSaver","f","uploadFile","filePath","success","removeSavedFile","log","fail","n","sleep","milSec","setTimeout"],"mappings":"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","file":"childPage/common/vendor.js","sourcesContent":["/*\r\nst.js\r\n\r\nCopyright 1999-present Alibaba Group Holding Ltd.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\nhttp://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\n\"use strict\"\r\n\r\nconst NlsClient = require(\"./nls\")\r\nconst EventBus = require(\"./eventbus\")\r\n\r\nclass SpeechTranscription {\r\n  constructor(config) {\r\n    this._event = new EventBus()\r\n    this._config = config\r\n  }\r\n\r\n  defaultStartParams() {\r\n    return {\r\n      format:\"pcm\",\r\n      sample_rate:16000,\r\n      enable_intermediate_result:true,\r\n      enable_punctuation_prediction:true,\r\n      enable_inverse_text_normalization:true\r\n    }\r\n  }\r\n\r\n  on(which, handler) {\r\n    this._event.on(which, handler)\r\n  }\r\n\r\n  async start(param) {\r\n    this._client = new NlsClient(this._config)\r\n    this._taskid = this._client.uuid()\r\n    let req = {\r\n      header:{\r\n        message_id:this._client.uuid(),\r\n        task_id:this._taskid,\r\n        namespace:\"SpeechTranscriber\",\r\n        name:\"StartTranscription\",\r\n        appkey:this._config.appkey\r\n      },\r\n      payload: param,\r\n      context: this._client.defaultContext()\r\n    }\r\n\r\n    return new Promise(async (resolve, reject) => {\r\n      try {\r\n        await this._client.start(\r\n          //onmessage\r\n          (msg, isBinary) => {\r\n            if (!isBinary) {\r\n              let str = msg.toString()\r\n              let msgObj = JSON.parse(str)\r\n              if (msgObj.header.name === \"TranscriptionStarted\") {\r\n                this._event.emit(\"started\", str)\r\n                resolve(str)\r\n              } else if (msgObj.header.name === \"TranscriptionResultChanged\") {\r\n                this._event.emit(\"changed\", str)\r\n              } else if (msgObj.header.name === \"TranscriptionCompleted\") {\r\n                this._event.emit(\"TranscriptionCompleted\", str)\r\n              } else if (msgObj.header.name === \"SentenceBegin\") {\r\n                this._event.emit(\"begin\", str)\r\n              } else if (msgObj.header.name === \"SentenceEnd\") {\r\n                this._event.emit(\"end\", str)\r\n              } else if (msgObj.header.name === \"TaskFailed\") {\r\n                this._client.shutdown()\r\n                this._client = null\r\n                this._event.emit(\"TaskFailed\", str)\r\n                this._event.emit(\"failed\", str)\r\n              }\r\n            }\r\n          },\r\n          //onclose\r\n          ()=> {\r\n            this._event.emit(\"closed\")\r\n          })\r\n        this._client.send(JSON.stringify(req), false)\r\n      } catch (error) {\r\n        reject(error)\r\n      }\r\n    })\r\n  }\r\n\r\n  async close(param) {\r\n    if (this._client == null) {\r\n      return new Promise((resolve, reject)=>{\r\n        wx.nextTick(()=>{\r\n          reject(\"client is null\")\r\n        })\r\n      })\r\n    }\r\n\r\n    let req = {\r\n      header:{\r\n        message_id:this._client.uuid(),\r\n        task_id:this._taskid,\r\n        namespace:\"SpeechTranscriber\",\r\n        name:\"StopTranscription\",\r\n        appkey:this._config.appkey\r\n      },\r\n      payload: param,\r\n      context: this._client.defaultContext()\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this._event.on(\"TranscriptionCompleted\",\r\n        (msg) => {\r\n          if (this._client) {\r\n            this._client.shutdown()\r\n            this._client = null\r\n          }\r\n          this._event.emit(\"completed\", msg)\r\n          resolve(msg)\r\n        })\r\n\r\n      this._event.on(\"TaskFailed\",\r\n        (msg) => {\r\n          reject(msg)\r\n        })\r\n\r\n      this._client.send(JSON.stringify(req), false)\r\n    })\r\n  }\r\n\r\n  ctrl(param) {\r\n    if (this._client == null) {\r\n      throw new Error(\"client is null\")\r\n    }\r\n    let req = {\r\n      header:{\r\n        message_id:this._client.uuid(),\r\n        task_id:this._taskid,\r\n        namespace:\"SpeechTranscriber\",\r\n        name:\"ControlTranscription\",\r\n        appkey:this._config.appkey\r\n      },\r\n      payload: param,\r\n      context: this._client.defaultContext()\r\n    }\r\n    this._client.send(JSON.stringify(req), false)\r\n  }\r\n\r\n  shutdown() {\r\n    if (this._client == null) {\r\n      return\r\n    }\r\n\r\n    this._client.shutdown()\r\n  }\r\n\r\n  sendAudio(data) {\r\n    if (this._client == null) {\r\n      return false\r\n    }\r\n\r\n    this._client.send(data, true)\r\n    return true\r\n  }\r\n}\r\n\r\nmodule.exports = SpeechTranscription\r\n","/*\r\nnls.js\r\n\r\nCopyright 1999-present Alibaba Group Holding Ltd.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\nhttp://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\"use strict\"\r\n\r\nconst uuid = require(\"./uuid\").uuid\r\n\r\nclass NlsClient {\r\n  constructor(config) {\r\n    if (!config || !config.url || !config.appkey || !config.token) {\r\n      throw new Error(\"invalid config!\")\r\n    }\r\n    this._config = config\r\n  }\r\n\r\n  start(onmessage, onclose) {\r\n    if (typeof onmessage !== 'function') {\r\n      throw new Error(\"expect function onmessage\")\r\n    }\r\n    if (typeof onclose != 'function') {\r\n      throw new Error(\"expect function onclose\")\r\n    }\r\n    this._ws = wx.connectSocket({\r\n      url: this._config.url,\r\n      tcpNoDelay: true,\r\n      header: {\r\n        \"X-NLS-Token\" : this._config.token\r\n      }\r\n    })\r\n    this._ws.onMessage((res) => {\r\n      if (typeof res.data === \"string\") {\r\n        onmessage(res.data, false)\r\n      } else {\r\n        onmessage(res.data, true)\r\n      }\r\n    })\r\n    this._ws.onClose((code, reason)=>{\r\n      onclose(code, reason)\r\n    })\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this._ws.onOpen((res)=>{\r\n        resolve(res)\r\n      })\r\n      this._ws.onError((errMsg)=>{\r\n        reject(errMsg)\r\n      })\r\n    })\r\n  }\r\n\r\n  send(data, isBinary) {\r\n    if (this._ws == null) {\r\n      return\r\n    }\r\n    this._ws.send({\r\n      data: data\r\n    })\r\n  }\r\n\r\n  uuid() {\r\n    return uuid(true)\r\n  }\r\n\r\n  shutdown() {\r\n    if (this._ws == null) {\r\n      return\r\n    }\r\n    this._ws.close()\r\n  }\r\n\r\n  defaultContext() {\r\n    return {\r\n      sdk:{\r\n        name: \"nls-wx-sdk\",\r\n        version: \"0.0.1\",\r\n        language: \"wxjs\"\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = NlsClient\r\n","const uuid = function (format) {\r\n    var s = [];\r\n    var hexDigits = \"0123456789abcdef\";\r\n    for (var i = 0; i < 36; i++) {\r\n      s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n    }\r\n    s[14] = \"4\"; \r\n    s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); \r\n    s[8] = s[13] = s[18] = s[23] = \"-\";\r\n    \r\n    var uuid = s.join(\"\");\r\n    if (format) {\r\n      return uuid.split(\"-\").join(\"\")\r\n    }\r\n    return uuid\r\n  }\r\n   \r\n  module.exports = {\r\n      uuid\r\n  }","/*\r\n    from github: https://github.com/littlebaozi/EventEmitter\r\n    author: littlebaozi\r\n    license: unknown\r\n*/\r\nclass EventBus {\r\n  // 订阅\r\n  on (event, fn, context) {\r\n      // 判断fn是否是函数\r\n      if(typeof fn != \"function\"){\r\n          console.error('fn must be a function');\r\n          return;\r\n      }\r\n      // 将event的fn存放在store中\r\n      this._stores = this._stores || {};\r\n      (this._stores[event] = this._stores[event] || []).push({cb: fn, ctx: context});\r\n   \r\n  }\r\n\r\n  // 发布\r\n  emit (event) {\r\n      this._stores = this._stores || {};\r\n      var store = this._stores[event],args;\r\n      // 遍历执行事件\r\n      if(store){\r\n          store = store.slice(0);\r\n          args = [].slice.call(arguments, 1); //获取传入的参数，https://segmentfault.com/q/1010000005643934\r\n\r\n          for(var i =0,len = store.length;i < len; i++){\r\n              store[i].cb.apply(store[i].ctx, args);\r\n          }\r\n      }\r\n  }\r\n\r\n  // 注销\r\n  off (event, fn) {\r\n      this._stores = this._stores || {};\r\n\r\n      // 删除所有\r\n      if(!arguments.length){\r\n          this._stores = [];\r\n          return;\r\n      }\r\n\r\n      var store = this._stores[event];\r\n      if(!store){\r\n          return;\r\n      }\r\n\r\n      // 删除指定event\r\n      if(arguments.length === 1){\r\n          delete this._stores[event];\r\n          return;\r\n      }\r\n\r\n      // 删除指定fn\r\n      for(var i=0, len = store.length; i < len; i++){\r\n\r\n          if(fn === store[i].cb){\r\n             store.splice(i,1);  //splice slice\r\n          }\r\n      }\r\n\r\n  }\r\n}\r\n\r\nmodule.exports = EventBus;","/*\r\nutil.js\r\n\r\nCopyright 1999-present Alibaba Group Holding Ltd.\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\nhttp://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n*/\r\n\r\nconst formatTime = date => {\r\n  const year = date.getFullYear()\r\n  const month = date.getMonth() + 1\r\n  const day = date.getDate()\r\n  const hour = date.getHours()\r\n  const minute = date.getMinutes()\r\n  const second = date.getSeconds()\r\n\r\n  return `${[year, month, day].map(formatNumber).join('_')}_${[hour, minute, second].map(formatNumber).join('_')}`\r\n}\r\n\r\nfunction padding2(t) {\r\n  if (t < 10) {\r\n    return \"0\" + t\r\n  } \r\n  return \"\" + t\r\n}\r\n\r\nfunction utctimestamp() {\r\n  let date = new Date()\r\n  let YYYY = date.getUTCFullYear()\r\n  let MM = padding2(date.getUTCMonth() + 1)\r\n  let DD = padding2(date.getUTCDate())\r\n  let HH = padding2(date.getUTCHours())\r\n  let mm = padding2(date.getUTCMinutes())\r\n  let ss = padding2(date.getUTCSeconds())\r\n  return `${YYYY}-${MM}-${DD}T${HH}:${mm}:${ss}Z`\r\n}\r\n\r\nfunction uploadToSaver(f) {\r\n  wx.uploadFile({\r\n    url: \"http://30.224.161.18:9110/res/upload\",\r\n    filePath: f,\r\n    name : \"file\",\r\n    success(res) {\r\n      wx.removeSavedFile({\r\n        filePath: f,\r\n        success: ()=> {\r\n          console.log(`remove ${f} done`)\r\n        },\r\n        fail: ()=>{\r\n          console.log(`remove ${f} failed`)\r\n        }\r\n      })\r\n    }\r\n  })\r\n} \r\n\r\nconst formatNumber = n => {\r\n  n = n.toString()\r\n  return n[1] ? n : `0${n}`\r\n}\r\n\r\nfunction sleep(milSec) {\r\n  return new Promise(resolve => {\r\n    setTimeout(resolve, milSec)\r\n  }) \r\n}\r\n\r\nmodule.exports = {\r\n  formatTime,\r\n  uploadToSaver,\r\n  utctimestamp,\r\n  sleep\r\n}\r\n"],"sourceRoot":""}